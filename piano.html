<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Custom Piano Keys with Tooltips</title>
  <style>
    body {
      background-color: #f0f0f0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    #keyboard {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .key {
      width: 100px;
      height: 320px;
      background-color: white;
      border: 2px solid black;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      box-sizing: border-box;
      position: relative;
      transition: transform 0.1s;
      user-select: none;
    }
    .key input, .key select {
      width: 80px;
      text-align: center;
      margin-top: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }
    .label {
      font-size: 14px;
    }
    button {
      padding: 6px 8px;
      font-size: 12px;
      cursor: pointer;
      margin: 5px;
    }
    .play-area {
      flex-grow: 1;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      border-top: 1px solid #ccc;
      border-bottom: 1px solid #ccc;
      margin: 5px 0;
      user-select: none;
    }
    .controls {
      display: flex;
      gap: 5px;
      justify-content: center;
      flex-wrap: wrap;
    }
    #add-button, #clear-button {
      margin-top: 20px;
      padding: 10px 15px;
      font-size: 14px;
    }
    #volume-control {
      margin-top: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #logic-section {
      margin-top: 40px;
      text-align: center;
      width: 90vw;
      max-width: 900px;
    }
    #customInput {
      margin-top: 10px;
      width: 100%;
      height: 140px;
      font-size: 12px;
      padding: 5px;
      resize: vertical;
      font-family: monospace;
      box-sizing: border-box;
    }
    #layoutDescription
    {
      margin-top: 10px;
      width: 50%;
      height: 40px;
      font-size: 12px;
      padding: 5px;
      resize: vertical;
      font-family: monospace;
      box-sizing: border-box;
    }
    #copyStatus {
      color: green;
      font-size: 13px;
      opacity: 0;
      transition: opacity 0.5s ease;
      margin-left: 10px;
      display: inline-block;
      vertical-align: middle;
    }
    /* Button groups in lines */
    .button-group {
      margin: 10px 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    #startFreqLabel, #octavesLabel {
      margin-right: 10px;
      font-weight: bold;
      font-size: 14px;
    }
    #startFreqInput, #octavesInput {
      width: 80px;
      font-size: 14px;
      padding: 3px 5px;
    }
    #inputRow {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    /* Tooltip question mark */
    .key-tooltip {
      font-weight: bold;
      font-size: 16px;
      color: #444;
      cursor: default;
      position: relative;
      user-select: none;
      margin-top: 6px;
    }
    /* Tooltip box */
    .custom-tooltip {
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #222;
      color: white;
      padding: 5px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      pointer-events: none;
      z-index: 100;
      opacity: 0.9;
      box-shadow: 0 0 6px rgba(0,0,0,0.4);
      
    }
    .top-buttons {
  position: absolute;
  top: 5px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  padding: 0 5px;
  pointer-events: auto;
}

.top-buttons button {
  font-size: 10px;
  padding: 2px 5px;
  cursor: pointer;
}

  </style>
</head>
<body>
  <div style="max-width: 800px; margin-top: 20px; background: #fff; padding: 15px; border: 1px solid #ccc; border-radius: 8px;">
  <h3>About This Tool</h3>
  <p>
    This interactive piano layout is a <strong>learning tool</strong> for exploring different <strong>tuning systems</strong>, including
    Equal Temperament, Just Intonation, and Pythagorean tuning. It's a toy designed to help you visualize and hear how different systems
    divide the octave and label frequencies. This tool is not intended for performance use, but for educational curiosity and experimentation.
    <br>
    <strong>Quick start</strong><br>
    - Press 'A' to play a note.<br>
    - Use "Add new Key" to add notes and edit their frequency. <br>
    - Use "Equal Temperament" button and "Load layout" for a standard keyboard. <br>
    <a href="#instructions">Full Instructions</a>
  </p>
</div>

  <h2>Click a key or press a keyboard key to play</h2>

  <button id="add-button" onclick="addKey()">Add New Key</button>
  <button id="clear-button" onclick="clearKeys()">Clear Keys</button>

  <div id="volume-control">
    <label for="volume">Volume:</label>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5" />
  </div>
  <br>---------------
  <div id="keyboard"></div>
<br>Description
  <textarea id="layoutDescription" placeholder="Keys layout description">
  </textarea>
  <div id="logic-section">

    <button onclick="runCustomLogic()">Load Layout</button>
    <button onclick="saveLayout()">Save Layout</button>
    <button onclick="copyToClipboard()">Copy to Clipboard</button><span id="copyStatus">Copied!</span>
    <button onclick="pasteFromClipboard()">Paste from Clipboard</button>

    <div id="inputRow">
      <div>
        <label id="startFreqLabel" for="startFreqInput">Start Frequency (Hz):</label>
        <input type="number" id="startFreqInput" value="440" min="20" max="20000" step="1" />
      </div>
      <div>
        <label id="octavesLabel" for="octavesInput">Octaves:</label>
        <input type="number" id="octavesInput" value="1" min="1" max="5" step="1" />
      </div>
    </div>

    <div class="button-group" style="margin-top: 5px;">
      <!-- Tunings buttons -->
      Tunings
      <button onclick="generatePythagorean()">Pythagorean Tuning</button>
      <button onclick="generateJustIntonation()">Just Intonation</button>
      <button onclick="generateEqualTemperament()">Equal Temperament</button>
    </div>

    <div class="button-group">
      <!-- Pentatonic scales -->
      Scales
      <button onclick="generatePentatonicMinor()">Pentatonic Minor</button>
      <button onclick="generatePentatonicMajor()">Pentatonic Major</button>
    </div>
    
    <textarea id="customInput" placeholder="Enter your logic input here...">{
  "comment": "Start with one key.",
  "keys": [
    { "freq": 440, "color": "white", "tooltip": "A4 - 440 Hz" }
  ]
}</textarea>
  </div>
<div style="max-width: 900px; margin-top: 30px; background: #fff; padding: 20px; border: 1px solid #ccc; border-radius: 8px;">
  <h3 id="instructions">How to Use This Tool</h3>
  
  <h4>üéπ Interacting with Keys</h4>
  <ul>
    <li>Click any key or press the corresponding keyboard letter (A‚Äì;) to play it.</li>
    <li>Each key shows its frequency, color, and an optional tooltip.</li>
    <li>Hover over the <strong>question mark (?)</strong> to see a description or frequency for the key.</li>
    <li>Use the <strong>‚Üë</strong> and <strong>‚Üì</strong> buttons on each key to vertically shift its position.</li>
  </ul>

  <h4>‚ûï Adding, Editing, and Moving Keys</h4>
  <ul>
    <li><strong>Add New Key</strong> adds a blank key with default settings.</li>
    <li>You can edit the frequency, change the color, and move the key left or right using the arrow buttons.</li>
    <li><strong>Delete</strong> removes a key from the layout.</li>
  </ul>

  <h4>üéõÔ∏è Tuning & Scale Presets</h4>
  <ul>
    <li>Use the tuning buttons to generate preset layouts like Equal Temperament, Just Intonation, or Pythagorean tuning.</li>
    <li>Use the scale buttons to create Pentatonic scales based on harmonic ratios.</li>
    <li>Adjust the base frequency (e.g., 440 Hz) and the number of octaves before generating.</li>
  </ul>

  <h4>üíæ Saving and Loading Layouts</h4>
  <ul>
    <li>Use <strong>Save Layout</strong> to serialize the current layout into editable JSON in the text box below.</li>
    <li><strong>Load Layout</strong> parses the JSON and updates the keyboard.</li>
    <li><strong>Copy to Clipboard</strong> and <strong>Paste from Clipboard</strong> let you move layouts in and out easily.</li>
  </ul>

  <h4>üìù Comments</h4>
  <ul>
    <li>The description field above the layout JSON lets you label or explain the tuning you're experimenting with.</li>
    <liThese descriptions are saved and loaded with the layout.</li>
  </ul>

  <h4>üîà Audio Settings</h4>
  <ul>
    <li>Use the volume slider to adjust playback volume.</li>
    <li>All sounds are generated using basic sine waves.</li>
  </ul>

  <p style="margin-top: 15px; font-size: 90%; color: #555;">
    This app is for learning and experimentation. Frequencies are approximate, and latency depends on browser performance.
  </p>
</div>

  <script>
    const keyboard = document.getElementById("keyboard");
    const volumeSlider = document.getElementById("volume");
    const customInput = document.getElementById("customInput");
    const layoutDescription = document.getElementById("layoutDescription");
    const copyStatus = document.getElementById("copyStatus");
    const startFreqInput = document.getElementById("startFreqInput");
    const octavesInput = document.getElementById("octavesInput");

    // Keyboard row layout for mapping keys
    const keyBindings = "ASDFGHJKL;";

    const keyRefs = [];

    // Single AudioContext shared for all notes
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // Play a short sine tone
    function playTone(freq) {
      const oscillator = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();

      oscillator.type = "sine";
      oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(parseFloat(volumeSlider.value), audioCtx.currentTime);

      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      oscillator.start();
      gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 1);
      oscillator.stop(audioCtx.currentTime + 1);
    }

    // Create a key element with optional tooltip text
    function createKey(frequency = 440, color = "white", tooltipText = null, baseVerticalOffset = 0) {
      const key = document.createElement("div");
      key.className = "key";
      key.style.backgroundColor = color;

      // Top buttons container
      const topButtons = document.createElement("div");
      topButtons.className = "top-buttons";

      const leftBtn = document.createElement("button");
      leftBtn.textContent = "‚Üì"; // Placeholder label
      leftBtn.className = "btn-left";

      const rightBtn = document.createElement("button");
      rightBtn.textContent = "‚Üë"; // Placeholder label
      rightBtn.className = "btn-right";
      let verticalOffset = -baseVerticalOffset; // Track vertical position
      key.style.marginTop = `${verticalOffset}px`;
      leftBtn.onclick = (e) => {
        e.stopPropagation();
        verticalOffset = Math.max(0, verticalOffset+20); // Move down
        key.style.marginTop = `${verticalOffset}px`;
      };

      rightBtn.onclick = (e) => {
        e.stopPropagation();
        verticalOffset -= 20; // Move up, but not above base
        key.style.marginTop = `${verticalOffset}px`;
      };

      topButtons.appendChild(leftBtn);
      topButtons.appendChild(rightBtn);
      key.appendChild(topButtons);


      // Keyboard mapping label
      const label = document.createElement("div");
      label.className = "label";
      label.textContent = keyBindings[keyRefs.length] || "";

      const freqLabel = document.createElement("div");
      freqLabel.className = "label";
      freqLabel.textContent = "Freq (Hz)";

      const input = document.createElement("input");
      input.type = "number";
      input.value = frequency;
      input.min = 20;
      input.max = 20000;

      const colorSelect = document.createElement("select");
      ["white", "lightblue", "lightgreen", "lightpink", "yellow", "orange", "gray"].forEach(c => {
        const option = document.createElement("option");
        option.value = c;
        option.textContent = c;
        if (c === color) option.selected = true;
        colorSelect.appendChild(option);
      });

      colorSelect.onchange = () => {
        key.style.backgroundColor = colorSelect.value;
      };

      const playArea = document.createElement("div");
      playArea.className = "play-area";
      playArea.onclick = () => {
        const freq = parseFloat(input.value);
        if (isNaN(freq) || freq < 20 || freq > 20000) {
          alert("Please enter a valid frequency between 20 and 20000 Hz.");
          return;
        }
        playTone(freq);
      };

      // Tooltip question mark with custom tooltip box
      const tooltip = document.createElement("div");
      tooltip.className = "key-tooltip";
      tooltip.textContent = "?";
      tooltip.style.position = "relative";

      const tooltipBox = document.createElement("div");
      tooltipBox.className = "custom-tooltip";
      tooltipBox.style.display = "none";

      // Use tooltipText if provided, else fallback to frequency
      tooltipBox.textContent = tooltipText || `${frequency} Hz`;

      tooltip.addEventListener("mouseenter", () => {
        tooltipBox.style.display = "block";
      });
      tooltip.addEventListener("mouseleave", () => {
        tooltipBox.style.display = "none";
      });

      // Update tooltip when freq input changes if no custom tooltipText
      input.addEventListener("input", () => {
        if (!tooltipText) {
          const freq = parseFloat(input.value);
          tooltipBox.textContent = isNaN(freq) ? "Invalid frequency" : `${freq} Hz`;
        }
      });

      tooltip.appendChild(tooltipBox);

      const controls = document.createElement("div");
      controls.className = "controls";

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        const index = keyRefs.indexOf(key);
        if (index > -1) keyRefs.splice(index, 1);
        keyboard.removeChild(key);
        updateKeyLabels();
      };

      const moveLeftBtn = document.createElement("button");
      moveLeftBtn.textContent = "‚Üê";
      moveLeftBtn.onclick = (e) => {
        e.stopPropagation();
        const prev = key.previousElementSibling;
        if (prev) {
          keyboard.insertBefore(key, prev);
          // Update array order
          const idx = keyRefs.indexOf(key);
          if (idx > 0) {
            keyRefs.splice(idx, 1);
            keyRefs.splice(idx - 1, 0, key);
          }
          updateKeyLabels();
        }
      };

      const moveRightBtn = document.createElement("button");
      moveRightBtn.textContent = "‚Üí";
      moveRightBtn.onclick = (e) => {
        e.stopPropagation();
        const next = key.nextElementSibling;
        if (next) {
          keyboard.insertBefore(next, key);
          // Update array order
          const idx = keyRefs.indexOf(key);
          if (idx > -1 && idx < keyRefs.length - 1) {
            keyRefs.splice(idx, 1);
            keyRefs.splice(idx + 1, 0, key);
          }
          updateKeyLabels();
        }
      };

      controls.appendChild(moveLeftBtn);
      controls.appendChild(moveRightBtn);
      controls.appendChild(deleteBtn);

      key.appendChild(label);
      key.appendChild(freqLabel);
      key.appendChild(input);
      key.appendChild(colorSelect);
      key.appendChild(tooltip);
      key.appendChild(playArea);
      key.appendChild(controls);

      keyRefs.push(key);
      return key;
    }

    function addKey(freq = 440, color = "white", tooltipText = null, verticalOffset = 0) {
      const newKey = createKey(freq, color, tooltipText, verticalOffset);
      keyboard.appendChild(newKey);
    }

    function clearKeys() {
      keyboard.innerHTML = "";
      keyRefs.length = 0;
    }

    function updateKeyLabels() {
      keyRefs.forEach((keyEl, i) => {
        const labelDiv = keyEl.querySelector(".label");
        if (labelDiv) {
          labelDiv.textContent = keyBindings[i] || "";
        }
      });
    }

    function runCustomLogic() {
      const input = customInput.value;
      try {
        const parsed = JSON.parse(input);
        // Support old array-only or new object with comment + keys
        layoutDescription.value = parsed.comment;
        let keys;
        if (Array.isArray(parsed)) {
          keys = parsed;
        } else if (parsed.keys && Array.isArray(parsed.keys)) {
          keys = parsed.keys;
        } else {
          throw new Error("Invalid format: expected an array or { keys: [...] } object");
        }
        clearKeys();
        keys.forEach(k => {
          if (typeof k.freq !== "number" || typeof k.color !== "string") {
            throw new Error("Each key must have a 'freq' (number) and 'color' (string).");
          }
          addKey(k.freq, k.color, k.tooltip || null, k.verticalOffset);
        });
        updateKeyLabels();
      } catch (e) {
        alert("Failed to load keys: " + e.message);
      }
    }

    function saveLayout() {
      const keysData = keyRefs.map(k => {
        const input = k.querySelector("input");
        const colorSelect = k.querySelector("select");
        const tooltipDiv = k.querySelector(".custom-tooltip");
        return {
          freq: parseFloat(input.value),
          color: colorSelect.value,
          tooltip: tooltipDiv ? tooltipDiv.textContent : null,
          verticalOffset: 0
        };
      });
      // Save with a comment describing layout (empty for now)
      const comment = layoutDescription.value;
      customInput.value = JSON.stringify({ comment, keys: keysData }, null, 2);
    }

    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(customInput.value);
        copyStatus.style.opacity = "1";
        setTimeout(() => {
          copyStatus.style.opacity = "0";
        }, 2000);
      } catch {
        alert("Copy failed");
      }
    }

    async function pasteFromClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        customInput.value = text;
      } catch {
        alert("Paste failed");
      }
    }

    // Keyboard play with no repeat while holding key
    const heldKeys = new Set();
    document.addEventListener("keydown", (e) => {
      if (audioCtx.state === "suspended") audioCtx.resume();
      const keyChar = e.key.toUpperCase();
      if (heldKeys.has(keyChar)) return;
      heldKeys.add(keyChar);

      const index = keyBindings.indexOf(keyChar);
      if (index !== -1 && index < keyRefs.length) {
        const keyEl = keyRefs[index];
        const input = keyEl.querySelector("input");
        const freq = parseFloat(input.value);

        if (!isNaN(freq)) {
          playTone(freq);
          keyEl.style.transform = "scale(0.95)";
        }
      }
    });

    document.addEventListener("keyup", (e) => {
      const keyChar = e.key.toUpperCase();
      heldKeys.delete(keyChar);

      const index = keyBindings.indexOf(keyChar);
      if (index !== -1 && index < keyRefs.length) {
        const keyEl = keyRefs[index];
        keyEl.style.transform = "";
      }
    });

    // --- Tuning Generators ---

    function generateEqualTemperament() {
  const baseFreq = parseFloat(startFreqInput.value) || 440;
  const octaves = parseInt(octavesInput.value) || 1;
  const comment = "Equal Temperament divides the octave into 12 equal logarithmic steps (12th root of 2). Black keys are colored gray.";
  const steps = 12 * octaves;
  const keys = [];
  const blackKeys = new Set([1, 3, 6, 8, 10]); // black key semitone offsets
  for (let i = 0; i < steps; i++) {
    const freq = baseFreq * Math.pow(2, i / 12);
    const ratio = Math.pow(2, i / 12);
    const ratioStr = ratio.toFixed(4);
    const isBlack = blackKeys.has(i % 12);
    keys.push({
      freq: +freq.toFixed(2),
      color: isBlack ? "gray" : "white",
      tooltip: `${baseFreq.toFixed(2)} * 2^(${i}/12)`,
      verticalOffset: isBlack ? 20 : 0
    });
  }
  customInput.value = JSON.stringify({ comment, keys }, null, 2);
}

    function generateJustIntonation() {
      const baseFreq = parseFloat(startFreqInput.value) || 440;
      const octaves = parseInt(octavesInput.value) || 1;
      const comment = "Just Intonation uses simple whole number ratios to produce consonant intervals.";
      const notes = [
        "Root (1/1)",
        "Major 2nd (9/8)",
        "Major 3rd (5/4)",
        "Perfect 4th (4/3)",
        "Perfect 5th (3/2)",
        "Major 6th (5/3)",
        "Major 7th (15/8)"
      ];
      const ratios = [
        { ratio: 1 / 1, color: "white" },
        { ratio: 9 / 8, color: "white" },
        { ratio: 5 / 4, color: "white" },
        { ratio: 4 / 3, color: "white" },
        { ratio: 3 / 2, color: "white" },
        { ratio: 5 / 3, color: "white" },
        { ratio: 15 / 8, color: "white" }
      ];
      const keys = [];
      for (let o = 0; o < octaves; o++) {
        const octaveMultiplier = Math.pow(2, o);
        ratios.forEach((r, i) => {
          const freq = baseFreq * r.ratio * octaveMultiplier;
          keys.push({
            freq: +freq.toFixed(2),
            color: r.color,
            tooltip: notes[i] || `Ratio: ${r.ratio.toFixed(4)}`,
            verticalOffset: 0
          });
        });
      }
      customInput.value = JSON.stringify({ comment, keys }, null, 2);
    }

    function generatePythagorean() {
      const baseFreq = parseFloat(startFreqInput.value) || 440;
      const octaves = parseInt(octavesInput.value) || 1;
      const comment = "Pythagorean tuning based on pure perfect fifths (ratio 3/2).";
      // Pythagorean scale intervals (ratios) relative to root:
      // We'll do one octave scale: unison, major second, major third, perfect fourth, perfect fifth, major sixth, major seventh
      const notes = [
        "Root (1/1)",
        "Major 2nd (9/8)",
        "Major 3rd (81/64)",
        "Perfect 4th (4/3)",
        "Perfect 5th (3/2)",
        "Major 6th (27/16)",
        "Major 7th (243/128)"
      ];
      const ratios = [
        1 / 1,
        9 / 8,
        81 / 64,
        4 / 3,
        3 / 2,
        27 / 16,
        243 / 128
      ];
      const keys = [];
      for (let o = 0; o < octaves; o++) {
        const octaveMultiplier = Math.pow(2, o);
        ratios.forEach((ratio, i) => {
          const freq = baseFreq * ratio * octaveMultiplier;
          keys.push({
            freq: +freq.toFixed(2),
            color: "white",
            tooltip: notes[i],
            verticalOffset: 0
          });
        });
      }
      customInput.value = JSON.stringify({ comment, keys }, null, 2);
    }

    // Pentatonic Minor scale
    function generatePentatonicMinor() {
      const baseFreq = parseFloat(startFreqInput.value) || 440;
      const octaves = parseInt(octavesInput.value) || 1;
      const comment = "Pentatonic Minor scale contains 5 notes per octave, common in folk and blues music.";
      const ratios = [
        { ratio: 1 / 1, color: "white", name: "Root" },
        { ratio: 6 / 5, color: "white", name: "Minor 3rd" },
        { ratio: 4 / 3, color: "white", name: "Perfect 4th" },
        { ratio: 3 / 2, color: "white", name: "Perfect 5th" },
        { ratio: 9 / 5, color: "white", name: "Minor 7th" }
      ];
      const keys = [];
      for (let o = 0; o < octaves; o++) {
        const octaveMultiplier = Math.pow(2, o);
        ratios.forEach(r => {
          keys.push({
            freq: +(baseFreq * r.ratio * octaveMultiplier).toFixed(2),
            color: r.color,
            tooltip: r.name,
            verticalOffset: 0
          });
        });
      }
      customInput.value = JSON.stringify({ comment, keys }, null, 2);
    }

    // Pentatonic Major scale
    function generatePentatonicMajor() {
      const baseFreq = parseFloat(startFreqInput.value) || 440;
      const octaves = parseInt(octavesInput.value) || 1;
      const comment = "Pentatonic Major scale contains 5 notes per octave, commonly used in folk music.";
      const ratios = [
        { ratio: 1 / 1, color: "white", name: "Root" },
        { ratio: 9 / 8, color: "white", name: "Major 2nd" },
        { ratio: 5 / 4, color: "white", name: "Major 3rd" },
        { ratio: 3 / 2, color: "white", name: "Perfect 5th" },
        { ratio: 5 / 3, color: "white", name: "Major 6th" }
      ];
      const keys = [];
      for (let o = 0; o < octaves; o++) {
        const octaveMultiplier = Math.pow(2, o);
        ratios.forEach(r => {
          keys.push({
            freq: +(baseFreq * r.ratio * octaveMultiplier).toFixed(2),
            color: r.color,
            tooltip: r.name,
            verticalOffset: 0
          });
        });
      }
      customInput.value = JSON.stringify({ comment, keys }, null, 2);
    }

    // Load initial key
    runCustomLogic();
  </script>
</body>
</html>
